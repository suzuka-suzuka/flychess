# 飞行棋四人联机功能说明

## 功能特性

### 1. 房间系统

- ✅ 自动生成4位数房间号
- ✅ 支持手动输入房间号加入游戏
- ✅ 房间最多支持4名玩家

### 2. 房主机制

- ✅ 第一个进入房间的玩家自动成为房主
- ✅ 房主有橙色"房主"标签
- ✅ 只有房主能看到"开始游戏"按钮
- ✅ 房主自动处于准备状态

### 3. 准备系统

- ✅ 所有非房主玩家需要点击"准备"按钮
- ✅ 准备状态实时显示（绿色✓已准备 / 灰色未准备）
- ✅ 可以取消准备
- ✅ 所有玩家准备后，房主才能开始游戏

### 4. 实时同步

- ✅ 玩家加入/离开实时通知
- ✅ 准备状态实时更新
- ✅ 游戏状态实时同步
- ✅ 骰子结果广播到所有玩家
- ✅ 棋子移动动画同步

### 5. 玩家标识

- ✅ 每个玩家有颜色标识（蓝/黄/绿/红）
- ✅ 房主有橙色"房主"标签
- ✅ 自己有蓝色"(你)"标签
- ✅ 准备状态标签

## 使用流程

### 房主创建房间

1. 点击"生成房间"按钮，自动生成4位数房间号
2. 输入自己的名字
3. 点击"创建房间（房主）"
4. 等待其他玩家加入
5. 当所有玩家准备后，点击"开始游戏"

### 其他玩家加入

1. 输入房间号（向房主索取）
2. 输入自己的名字
3. 点击"加入房间"
4. 点击"准备"按钮
5. 等待房主开始游戏

## 游戏规则

### 回合制

- 按照加入顺序轮流进行
- 只有当前回合的玩家可以掷骰子
- 掷到6可以再掷一次

### 准备条件

- 至少2名玩家
- 最多4名玩家
- 所有玩家必须准备

### 断线处理

- 玩家断线后自动移除
- 如果游戏中有玩家离开，游戏重置

## 技术实现

### 后端 (server.js)

- 使用 Socket.IO 实现实时通信
- 房间管理系统（Map 数据结构）
- 每个房间维护独立的游戏实例
- 事件：joinRoom, playerReady, startGame, rollDice, movePiece, resetGame

### 前端 (client.js)

- Socket.IO 客户端连接
- 实时接收游戏状态更新
- 动画系统同步
- 房间UI实时更新

### 数据同步

- roomUpdate: 房间玩家列表更新
- gameStart: 游戏开始
- rollResult: 骰子结果
- moveResult: 棋子移动结果
- playerLeft: 玩家离开通知
- error: 错误提示

## 启动方式

```bash
cd d:\edge\Yunzai\flychess
npm install
npm start
```

访问: <http://localhost:3000>

## 注意事项

1. 确保所有玩家在同一网络或使用公网IP
2. 房间号需要告知其他玩家
3. 房主离开会导致房间解散
4. 建议使用Chrome、Edge等现代浏览器
